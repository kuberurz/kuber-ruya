<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KUBER RÃœYA â€” RÃ¼ya & Fal</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --void: #04030a;
    --deep: #0d0920;
    --mid: #1a1035;
    --gold: #c9a84c;
    --gold-light: #e8cc80;
    --rose: #a05060;
    --rose-light: #d4788a;
    --silver: #b8b0cc;
    --text: #f0ecff;
    --text-bright: #ffffff;
    --muted: #7a6e90;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--void); color: var(--text);
    font-family: 'Cormorant Garamond', serif;
    min-height: 100vh; overflow-x: hidden;
  }
  .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
  .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--d) ease-in-out infinite; animation-delay: var(--delay); }
  @keyframes twinkle { 0%, 100% { opacity: 0.1; transform: scale(1); } 50% { opacity: 0.9; transform: scale(1.4); } }
  .nebula {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none;
    background:
      radial-gradient(ellipse 60% 40% at 20% 30%, rgba(80,40,120,0.25) 0%, transparent 70%),
      radial-gradient(ellipse 50% 60% at 80% 70%, rgba(160,80,96,0.15) 0%, transparent 70%),
      radial-gradient(ellipse 80% 50% at 50% 100%, rgba(13,9,32,0.8) 0%, transparent 70%);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GÄ°RÄ°Å EKRANI
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #welcome-screen {
    position: fixed; inset: 0; z-index: 1000;
    display: flex; align-items: center; justify-content: center;
    padding: 20px;
    background: var(--void);
    overflow-y: auto;
  }
  #welcome-screen.hidden { display: none; }

  .welcome-card {
    position: relative; z-index: 10;
    width: 100%; max-width: 440px;
    background: linear-gradient(145deg, rgba(26,16,53,0.95), rgba(13,9,32,0.98));
    border: 1px solid rgba(201,168,76,0.3);
    border-radius: 4px; padding: 36px 28px;
    animation: fadeIn 0.6s ease;
  }
  .welcome-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), var(--rose-light), var(--gold), transparent);
  }

  .welcome-symbol { font-size: 3rem; text-align: center; display: block; margin-bottom: 10px; animation: float 4s ease-in-out infinite; }
  .welcome-title {
    font-family: 'Cinzel', serif; font-size: clamp(1.1rem, 4vw, 1.5rem);
    letter-spacing: 0.15em; text-align: center;
    background: linear-gradient(135deg, var(--gold), var(--gold-light), var(--rose-light));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: 6px; line-height: 1.4;
  }
  .welcome-sub {
    text-align: center; font-size: 0.9rem; color: var(--muted);
    letter-spacing: 0.1em; margin-bottom: 28px;
  }
  .welcome-divider {
    display: flex; align-items: center; gap: 12px; margin-bottom: 24px;
  }
  .welcome-divider::before, .welcome-divider::after {
    content: ''; flex: 1; height: 1px;
    background: linear-gradient(90deg, transparent, rgba(201,168,76,0.4), transparent);
  }
  .welcome-divider span { color: var(--gold); font-size: 0.85rem; }

  .form-group { margin-bottom: 18px; }
  .form-label {
    font-family: 'Cinzel', serif; font-size: 0.6rem;
    letter-spacing: 0.2em; color: var(--gold);
    text-transform: uppercase; display: block; margin-bottom: 8px;
  }
  .form-input {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(184,176,204,0.2);
    border-radius: 2px; color: var(--text-bright);
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.05rem; font-weight: 400;
    padding: 12px 14px; outline: none;
    transition: border-color 0.3s; -webkit-appearance: none;
  }
  .form-input:focus { border-color: rgba(201,168,76,0.5); }
  .form-input::placeholder { color: var(--muted); }

  .date-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
  .date-row select {
    width: 100%;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(184,176,204,0.2);
    border-radius: 2px; color: var(--text-bright);
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem; padding: 12px 10px;
    outline: none; cursor: pointer;
    -webkit-appearance: none; appearance: none;
    transition: border-color 0.3s;
  }
  .date-row select:focus { border-color: rgba(201,168,76,0.5); }
  .date-row select option { background: #0d0920; color: var(--text-bright); }

  .toggle-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .toggle-btn {
    padding: 12px 8px; text-align: center;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(184,176,204,0.15);
    border-radius: 2px; cursor: pointer;
    color: var(--muted); font-family: 'Cormorant Garamond', serif;
    font-size: 0.95rem; transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  .toggle-btn.selected { border-color: var(--gold); background: rgba(201,168,76,0.08); color: var(--gold-light); }

  .welcome-btn {
    width: 100%; padding: 16px; margin-top: 8px;
    background: linear-gradient(135deg, rgba(201,168,76,0.18), rgba(160,80,96,0.15));
    border: 1px solid var(--gold); border-radius: 2px;
    color: var(--gold-light); font-family: 'Cinzel', serif;
    font-size: 0.78rem; letter-spacing: 0.2em;
    cursor: pointer; transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  .welcome-btn:hover { background: linear-gradient(135deg, rgba(201,168,76,0.28), rgba(160,80,96,0.22)); }
  .welcome-btn:active { transform: scale(0.98); }

  .form-error {
    color: var(--rose-light); font-size: 0.85rem;
    margin-top: 10px; text-align: center; display: none;
  }
  .form-error.show { display: block; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ANA UYGULAMA
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #app { display: none; }
  #app.show { display: block; }

  header {
    position: relative; z-index: 10;
    text-align: center; padding: 44px 20px 28px;
  }
  .logo-symbol { font-size: 2.5rem; display: block; margin-bottom: 8px; animation: float 4s ease-in-out infinite; }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
  .logo-title {
    font-family: 'Cinzel', serif;
    font-size: clamp(2rem, 6vw, 3.2rem);
    font-weight: 600; letter-spacing: 0.25em;
    background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 40%, var(--rose-light) 70%, var(--gold) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    margin-bottom: 6px;
  }
  .logo-subtitle { font-size: 0.95rem; color: var(--muted); letter-spacing: 0.3em; }
  .user-greeting {
    margin-top: 10px; font-size: 0.95rem; color: var(--gold-light);
    font-family: 'Cinzel', serif; letter-spacing: 0.08em;
  }
  .header-divider {
    display: flex; align-items: center; justify-content: center;
    gap: 16px; margin-top: 16px;
  }
  .header-divider::before, .header-divider::after {
    content: ''; width: 60px; height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .header-divider span { color: var(--gold); font-size: 1rem; }

  /* â”€â”€ TABS â”€â”€ */
  .tabs {
    position: relative; z-index: 10;
    display: flex; justify-content: center;
    max-width: 480px; margin: 0 auto 28px;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 2px; padding: 4px;
  }
  .tab-btn {
    flex: 1; padding: 11px 8px; background: none; border: none;
    cursor: pointer; font-family: 'Cinzel', serif; font-size: 0.65rem;
    letter-spacing: 0.1em; color: var(--muted); transition: all 0.3s;
  }
  .tab-btn.active { color: var(--gold); background: rgba(201,168,76,0.1); }

  .main { position: relative; z-index: 10; max-width: 600px; margin: 0 auto; padding: 0 16px 80px; }
  .panel { display: none; animation: fadeIn 0.5s ease; }
  .panel.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* â”€â”€ INPUT CARD â”€â”€ */
  .input-card {
    background: linear-gradient(145deg, rgba(26,16,53,0.8), rgba(13,9,32,0.9));
    border: 1px solid rgba(201,168,76,0.2);
    border-radius: 2px; padding: 24px 20px; margin-bottom: 20px;
    position: relative; overflow: hidden;
  }
  .input-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--gold), transparent);
  }
  .input-label {
    font-family: 'Cinzel', serif; font-size: 0.65rem;
    letter-spacing: 0.2em; color: var(--gold);
    text-transform: uppercase; margin-bottom: 10px; display: block;
  }
  textarea {
    width: 100%; background: rgba(255,255,255,0.04);
    border: 1px solid rgba(184,176,204,0.15); border-radius: 1px;
    color: var(--text-bright); font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem; font-weight: 400; line-height: 1.7;
    padding: 14px; resize: none; outline: none;
    transition: border-color 0.3s; min-height: 120px; -webkit-appearance: none;
  }
  textarea:focus { border-color: rgba(201,168,76,0.4); }
  textarea::placeholder { color: var(--muted); }

  /* â”€â”€ FAL TÄ°PÄ° â”€â”€ */
  .fortune-types { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin: 16px 0; }
  .fortune-type-btn {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(184,176,204,0.15);
    border-radius: 2px; padding: 12px 6px; cursor: pointer;
    text-align: center; transition: all 0.3s; color: var(--muted);
    font-family: 'Cormorant Garamond', serif; -webkit-tap-highlight-color: transparent;
  }
  .fortune-type-btn.selected { border-color: var(--gold); background: rgba(201,168,76,0.08); color: var(--gold-light); }
  .fortune-type-btn .icon { font-size: 1.5rem; display: block; margin-bottom: 3px; }
  .fortune-type-btn .label { font-size: 0.82rem; display: block; }

  /* â”€â”€ FOTOÄRAF â”€â”€ */
  .photo-upload-wrap { margin: 16px 0; }
  .photo-upload-area {
    border: 1.5px dashed rgba(201,168,76,0.35); border-radius: 4px;
    padding: 20px; text-align: center; cursor: pointer;
    transition: all 0.3s; position: relative; background: rgba(255,255,255,0.02);
  }
  .photo-upload-area:hover { border-color: var(--gold); background: rgba(201,168,76,0.05); }
  .photo-upload-area input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%; }
  .photo-upload-icon { font-size: 1.8rem; display: block; margin-bottom: 6px; }
  .photo-upload-label { font-family: 'Cinzel', serif; font-size: 0.65rem; letter-spacing: 0.15em; color: var(--gold); display: block; margin-bottom: 3px; }
  .photo-upload-sub { font-size: 0.82rem; color: var(--muted); }
  .photo-preview-wrap { display: none; position: relative; border-radius: 4px; overflow: hidden; border: 1px solid rgba(201,168,76,0.3); }
  .photo-preview-wrap.show { display: block; }
  .photo-preview-wrap img { width: 100%; max-height: 220px; object-fit: cover; display: block; }
  .photo-remove-btn {
    position: absolute; top: 8px; right: 8px;
    background: rgba(0,0,0,0.65); border: 1px solid rgba(255,255,255,0.2);
    color: #fff; border-radius: 50%; width: 28px; height: 28px;
    font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
  }
  .photo-remove-btn:hover { background: rgba(160,80,96,0.85); }

  /* â”€â”€ CTA â”€â”€ */
  .cta-btn {
    width: 100%; padding: 16px;
    background: linear-gradient(135deg, rgba(201,168,76,0.15), rgba(160,80,96,0.15));
    border: 1px solid var(--gold); border-radius: 2px;
    color: var(--gold-light); font-family: 'Cinzel', serif;
    font-size: 0.78rem; letter-spacing: 0.15em;
    cursor: pointer; transition: all 0.3s; margin-top: 16px;
    -webkit-tap-highlight-color: transparent;
  }
  .cta-btn:hover { background: linear-gradient(135deg, rgba(201,168,76,0.25), rgba(160,80,96,0.2)); }
  .cta-btn:active { transform: scale(0.98); }
  .cta-btn:disabled { opacity: 0.5; cursor: not-allowed; }

  /* â”€â”€ LOADING â”€â”€ */
  .loading { display: none; text-align: center; padding: 50px 20px; }
  .loading.show { display: block; }
  .crystal-ball { font-size: 3.5rem; display: block; margin-bottom: 16px; animation: pulse 2s ease-in-out infinite; }
  @keyframes pulse {
    0%, 100% { transform: scale(1); filter: drop-shadow(0 0 10px rgba(201,168,76,0.3)); }
    50% { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(201,168,76,0.7)); }
  }
  .loading-text { color: var(--muted); font-size: 1rem; animation: fadeInOut 2s ease-in-out infinite; }
  @keyframes fadeInOut { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

  /* â”€â”€ RESULT CARD â”€â”€ */
  .result-card {
    display: none;
    background: linear-gradient(145deg, rgba(26,16,53,0.9), rgba(13,9,32,0.95));
    border: 1px solid rgba(201,168,76,0.3); border-radius: 2px;
    overflow: hidden; animation: revealCard 0.8s ease;
  }
  .result-card.show { display: block; }
  @keyframes revealCard { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
  .result-header {
    background: linear-gradient(135deg, rgba(201,168,76,0.1), rgba(160,80,96,0.08));
    border-bottom: 1px solid rgba(201,168,76,0.2);
    padding: 20px; display: flex; align-items: center; gap: 14px;
  }
  .result-icon { font-size: 1.8rem; }
  .result-category { font-family: 'Cinzel', serif; font-size: 0.6rem; letter-spacing: 0.25em; color: var(--gold); text-transform: uppercase; }
  .result-title { font-size: 1.1rem; color: var(--text-bright); margin-top: 2px; font-weight: 500; }
  .result-body { padding: 24px 20px; }
  .result-text { font-size: 1.05rem; line-height: 1.85; color: var(--text-bright); }

  /* KUBER bÃ¶lÃ¼m stili */
  .k-section { margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid rgba(201,168,76,0.12); }
  .k-section:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
  .k-section-title {
    font-family: 'Cinzel', serif; font-size: 0.7rem; letter-spacing: 0.18em;
    color: var(--gold); text-transform: uppercase; margin-bottom: 10px;
    display: flex; align-items: center; gap: 8px;
  }
  .k-emoji { font-size: 1.1rem; }
  .k-section p { font-size: 1.08rem; line-height: 1.85; color: var(--text-bright); font-weight: 400; }
  .k-closing {
    margin-top: 20px; padding: 16px 18px;
    background: linear-gradient(135deg, rgba(201,168,76,0.08), rgba(160,80,96,0.05));
    border-left: 2px solid var(--gold); border-radius: 0 2px 2px 0;
    color: var(--silver); font-size: 1rem; line-height: 1.8; font-weight: 400;
  }

  .result-footer {
    border-top: 1px solid rgba(201,168,76,0.1); padding: 16px 20px;
    display: flex; justify-content: space-between; align-items: center; gap: 10px; flex-wrap: wrap;
  }
  .result-tip { font-size: 0.85rem; color: var(--muted); }
  .new-btn {
    padding: 9px 20px; background: none; border: 1px solid rgba(201,168,76,0.3);
    border-radius: 2px; color: var(--gold); font-family: 'Cinzel', serif;
    font-size: 0.65rem; letter-spacing: 0.12em; cursor: pointer; transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }

  /* â”€â”€ ORACLE GÄ°RÄ°Å KARTI â”€â”€ */
  .oracle-intro {
    background: linear-gradient(145deg, rgba(26,16,53,0.6), rgba(13,9,32,0.8));
    border: 1px solid rgba(160,80,96,0.25);
    border-radius: 2px; padding: 28px 20px; text-align: center;
    position: relative; overflow: hidden; margin-bottom: 20px;
  }
  .oracle-intro::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
    background: linear-gradient(90deg, transparent, var(--rose-light), transparent);
  }
  .oracle-sign { font-size: 2.5rem; margin-bottom: 10px; display: block; }
  .oracle-intro-title { font-family: 'Cinzel', serif; font-size: 0.65rem; letter-spacing: 0.2em; color: var(--rose-light); text-transform: uppercase; margin-bottom: 14px; }
  .oracle-intro-text { font-size: 1.1rem; line-height: 1.8; color: var(--silver); }

  /* â”€â”€ ORACLE PAYLAÅIM KARTI â”€â”€ */
  .oracle-share-card {
    display: none; border-radius: 16px; overflow: hidden;
    position: relative; margin-bottom: 16px;
    background: #080412; border: 1px solid rgba(201,168,76,0.25);
    box-shadow: 0 0 60px rgba(80,40,120,0.3), 0 0 120px rgba(0,0,0,0.5);
  }
  .oracle-share-card.show { display: block; animation: revealCard 0.8s ease; }
  .osc-bg {
    position: absolute; inset: 0; pointer-events: none;
    background:
      radial-gradient(ellipse 80% 60% at 50% -10%, rgba(201,168,76,0.12) 0%, transparent 55%),
      radial-gradient(ellipse 50% 40% at 5% 95%, rgba(160,80,96,0.12) 0%, transparent 55%),
      radial-gradient(ellipse 40% 40% at 95% 80%, rgba(80,40,120,0.12) 0%, transparent 55%);
  }
  .osc-lines {
    position: absolute; inset: 0; pointer-events: none; overflow: hidden; opacity: 0.025;
    background-image: repeating-linear-gradient(0deg, rgba(255,255,255,0.8) 0px, rgba(255,255,255,0.8) 1px, transparent 1px, transparent 36px);
  }
  .osc-inner { position: relative; z-index: 1; padding: 26px 22px 22px; }
  .osc-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
  .osc-brand { display: flex; align-items: center; gap: 7px; }
  .osc-brand-icon { font-size: 1.1rem; }
  .osc-brand-text { font-family: 'Cinzel', serif; font-size: 0.65rem; letter-spacing: 0.2em; color: rgba(201,168,76,0.65); }
  .osc-date { font-size: 0.72rem; color: var(--muted); font-family: 'Cinzel', serif; letter-spacing: 0.04em; }
  .osc-tag { font-family: 'Cinzel', serif; font-size: 0.58rem; letter-spacing: 0.25em; color: var(--rose-light); text-transform: uppercase; margin-bottom: 7px; }
  .osc-headline {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(1.45rem, 5vw, 1.9rem);
    font-weight: 300; color: #ffffff; line-height: 1.25; margin-bottom: 22px; letter-spacing: 0.01em;
  }
  .osc-divider { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
  .osc-divider::before, .osc-divider::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, transparent, rgba(201,168,76,0.4), transparent); }
  .osc-divider-icon { color: var(--gold); font-size: 0.8rem; }
  .osc-sections { display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px; }
  .osc-section { display: flex; gap: 13px; align-items: flex-start; }
  .osc-section-icon { font-size: 1.35rem; flex-shrink: 0; }
  .osc-section-label { font-family: 'Cinzel', serif; font-size: 0.56rem; letter-spacing: 0.15em; color: var(--gold); text-transform: uppercase; margin-bottom: 4px; }
  .osc-section-text { font-size: 0.97rem; line-height: 1.75; color: rgba(240,236,255,0.92); font-weight: 400; }
  .osc-lucky {
    display: flex; justify-content: space-around; padding: 13px;
    margin-bottom: 20px; background: rgba(201,168,76,0.06);
    border: 1px solid rgba(201,168,76,0.18); border-radius: 8px; flex-wrap: wrap; gap: 8px;
  }
  .osc-lucky-item { text-align: center; }
  .osc-lucky-label { font-family: 'Cinzel', serif; font-size: 0.54rem; letter-spacing: 0.1em; color: var(--muted); text-transform: uppercase; display: block; margin-bottom: 4px; }
  .osc-lucky-val { font-size: 1.05rem; font-weight: 600; color: var(--gold-light); }
  .osc-closing {
    padding: 15px 16px; margin-bottom: 18px;
    background: linear-gradient(135deg, rgba(80,40,120,0.2), rgba(160,80,96,0.1));
    border-radius: 8px; border: 1px solid rgba(201,168,76,0.14);
    font-size: 1rem; line-height: 1.75; color: #e8e0ff; font-weight: 400;
  }
  .osc-footer {
    display: flex; justify-content: space-between; align-items: center;
    padding-top: 14px; border-top: 1px solid rgba(201,168,76,0.12);
  }
  .osc-footer-tip { font-size: 0.78rem; color: var(--muted); }
  .osc-footer-logo { font-family: 'Cinzel', serif; font-size: 0.62rem; letter-spacing: 0.15em; color: rgba(201,168,76,0.42); }
  .oracle-actions { display: none; gap: 8px; margin-top: 12px; }
  .oracle-actions.show { display: flex; }
  .oracle-action-btn {
    flex: 1; padding: 12px; background: rgba(255,255,255,0.04);
    border: 1px solid rgba(201,168,76,0.25); border-radius: 2px;
    color: var(--gold); font-family: 'Cinzel', serif; font-size: 0.65rem;
    letter-spacing: 0.1em; cursor: pointer; transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  .oracle-action-btn:hover { background: rgba(201,168,76,0.1); }

  /* â”€â”€ HATA â”€â”€ */
  .error-msg {
    display: none; background: rgba(160,80,96,0.1);
    border: 1px solid rgba(160,80,96,0.3); padding: 14px 20px;
    border-radius: 2px; color: var(--rose-light); text-align: center;
    margin-top: 14px; font-size: 0.95rem;
  }
  .error-msg.show { display: block; }

  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--void); }
  ::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.2); border-radius: 3px; }
</style>
</head>
<body>

<div class="nebula"></div>
<div class="stars" id="stars"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GÄ°RÄ°Å EKRANI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="welcome-screen">
  <div class="welcome-card">
    <span class="welcome-symbol">ğŸŒ™</span>
    <div class="welcome-title">KUBER'in Evrenine<br>HoÅŸ Geldiniz</div>
    <p class="welcome-sub">Sizi tanÄ±mak istiyorum...</p>
    <div class="welcome-divider"><span>âœ¦</span></div>

    <div class="form-group">
      <label class="form-label">âœ¦ Ad Soyad</label>
      <input class="form-input" type="text" id="w-name" placeholder="AdÄ±nÄ±z ve soyadÄ±nÄ±z">
    </div>

    <div class="form-group">
      <label class="form-label">âœ¦ DoÄŸum Tarihi</label>
      <div class="date-row">
        <select id="w-day"><option value="">GÃ¼n</option></select>
        <select id="w-month">
          <option value="">Ay</option>
          <option value="1">Ocak</option><option value="2">Åubat</option><option value="3">Mart</option>
          <option value="4">Nisan</option><option value="5">MayÄ±s</option><option value="6">Haziran</option>
          <option value="7">Temmuz</option><option value="8">AÄŸustos</option><option value="9">EylÃ¼l</option>
          <option value="10">Ekim</option><option value="11">KasÄ±m</option><option value="12">AralÄ±k</option>
        </select>
        <select id="w-year"><option value="">YÄ±l</option></select>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">âœ¦ Medeni Durum</label>
      <div class="toggle-row">
        <button class="toggle-btn" id="btn-bekar" onclick="selectToggle('medeni','bekar')">ğŸ’ Bekar</button>
        <button class="toggle-btn" id="btn-evli" onclick="selectToggle('medeni','evli')">ğŸ‘« Evli</button>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">âœ¦ Ã‡alÄ±ÅŸma Durumu</label>
      <div class="toggle-row">
        <button class="toggle-btn" id="btn-calisiyor" onclick="selectToggle('calisma','calisiyor')">ğŸ’¼ Ã‡alÄ±ÅŸÄ±yorum</button>
        <button class="toggle-btn" id="btn-calismÄ±yor" onclick="selectToggle('calisma','calismÄ±yor')">ğŸŒ¿ Ã‡alÄ±ÅŸmÄ±yorum</button>
      </div>
    </div>

    <div class="form-error" id="form-error">LÃ¼tfen tÃ¼m bilgileri doldurun.</div>
    <button class="welcome-btn" onclick="submitWelcome()">âœ¦ KUBER'Ä°N EVRENÄ°NE GÄ°R âœ¦</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ANA UYGULAMA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <header>
    <span class="logo-symbol">ğŸŒ™</span>
    <h1 class="logo-title">KUBER RÃœYA</h1>
    <p class="logo-subtitle">RÃ¼ya Tabiri & Fal Rehberi</p>
    <p class="user-greeting" id="user-greeting"></p>
    <div class="header-divider"><span>âœ¦</span></div>
  </header>

  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('ruya', this)">âœ¦ RÃœYA</button>
    <button class="tab-btn" onclick="switchTab('fal', this)">â˜½ FAL</button>
    <button class="tab-btn" onclick="switchTab('oracle', this)">â˜… GÃœNÃœN MESAJI</button>
  </div>

  <main class="main">

    <!-- RÃœYA TABÄ°RÄ° -->
    <div class="panel active" id="panel-ruya">
      <div class="input-card">
        <label class="input-label">âœ¦ RÃ¼yanÄ± Anlat</label>
        <textarea id="ruya-input" rows="5" placeholder="Bu gece gÃ¶rdÃ¼ÄŸÃ¼n rÃ¼yayÄ± ayrÄ±ntÄ±larÄ±yla anlat... Ne hissettin, kimler vardÄ±, ne gÃ¶rdÃ¼n?"></textarea>
        <button class="cta-btn" onclick="tabir('ruya')" id="ruya-btn">âœ¦ RÃœYAMI TABÄ°R ET âœ¦</button>
      </div>
      <div class="loading" id="ruya-loading">
        <span class="crystal-ball">ğŸ”®</span>
        <p class="loading-text">RÃ¼yanÄ±n sÄ±rlarÄ±na dalÄ±yorum...</p>
      </div>
      <div class="error-msg" id="ruya-error"></div>
      <div class="result-card" id="ruya-result">
        <div class="result-header">
          <div class="result-icon">ğŸŒ™</div>
          <div>
            <div class="result-category">RÃ¼ya Tabiri</div>
            <div class="result-title">Gece MesajÄ±</div>
          </div>
        </div>
        <div class="result-body"><div class="result-text" id="ruya-result-text"></div></div>
        <div class="result-footer">
          <span class="result-tip">âœ¦ RÃ¼yalar ruhun dili ile konuÅŸur</span>
          <button class="new-btn" onclick="resetPanel('ruya')">YENÄ° RÃœYA</button>
        </div>
      </div>
    </div>

    <!-- FAL -->
    <div class="panel" id="panel-fal">
      <div class="input-card">
        <label class="input-label">â˜½ Fal TÃ¼rÃ¼nÃ¼ SeÃ§</label>
        <div class="fortune-types">
          <button class="fortune-type-btn selected" data-type="kahve" onclick="selectFalType(this)">
            <span class="icon">â˜•</span><span class="label">Kahve FalÄ±</span>
          </button>
          <button class="fortune-type-btn" data-type="el" onclick="selectFalType(this)">
            <span class="icon">ğŸ¤²</span><span class="label">El FalÄ±</span>
          </button>
          <button class="fortune-type-btn" data-type="yildiz" onclick="selectFalType(this)">
            <span class="icon">â­</span><span class="label">YÄ±ldÄ±z FalÄ±</span>
          </button>
          <button class="fortune-type-btn" data-type="genel" onclick="selectFalType(this)">
            <span class="icon">ğŸŒŸ</span><span class="label">Genel Fal</span>
          </button>
        </div>

        <label class="input-label" style="margin-top:16px;">â˜½ AklÄ±ndaki Konu</label>
        <textarea id="fal-input" rows="3" placeholder="AÅŸk mÄ±, kariyer mi, para mÄ±? Sorunuzu yazÄ±n... BoÅŸ bÄ±rakÄ±rsanÄ±z kader yÃ¶nlendirir."></textarea>

        <!-- Sadece kahve & el falÄ± -->
        <div id="fal-photo-wrap" class="photo-upload-wrap">
          <label class="input-label" style="margin-top:16px;">ğŸ“¸ FotoÄŸraf YÃ¼kle</label>
          <div class="photo-preview-wrap" id="fal-photo-preview">
            <img id="fal-photo-img" src="" alt="FotoÄŸraf">
            <button class="photo-remove-btn" onclick="removePhoto()">âœ•</button>
          </div>
          <div class="photo-upload-area" id="fal-upload-area">
            <input type="file" accept="image/*" onchange="handlePhotoUpload(event)" id="fal-photo-input">
            <span class="photo-upload-icon">ğŸ“·</span>
            <span class="photo-upload-label">FotoÄŸraf YÃ¼kle</span>
            <span class="photo-upload-sub" id="fal-photo-sub">Kahve fincanÄ±nÄ±n fotoÄŸrafÄ±nÄ± Ã§ek, KUBER okusun</span>
          </div>
        </div>

        <button class="cta-btn" onclick="tabir('fal')" id="fal-btn">â˜½ FALIMA BAK â˜½</button>
      </div>
      <div class="loading" id="fal-loading">
        <span class="crystal-ball">â˜½</span>
        <p class="loading-text">YÄ±ldÄ±zlara soruyorum...</p>
      </div>
      <div class="error-msg" id="fal-error"></div>
      <div class="result-card" id="fal-result">
        <div class="result-header">
          <div class="result-icon" id="fal-result-icon">â˜•</div>
          <div>
            <div class="result-category" id="fal-result-category">Kahve FalÄ±</div>
            <div class="result-title">Kaderin Sesi</div>
          </div>
        </div>
        <div class="result-body"><div class="result-text" id="fal-result-text"></div></div>
        <div class="result-footer">
          <span class="result-tip">â˜½ Evrenin sÄ±rlarÄ± sende saklÄ±</span>
          <button class="new-btn" onclick="resetPanel('fal')">YENÄ° FAL</button>
        </div>
      </div>
    </div>

    <!-- GÃœNÃœN MESAJI -->
    <div class="panel" id="panel-oracle">
      <div class="oracle-intro">
        <span class="oracle-sign">âœ¨</span>
        <div class="oracle-intro-title">GÃ¼nÃ¼n Kozmik MesajÄ±</div>
        <div class="oracle-intro-text">Evren sana bugÃ¼n ne sÃ¶ylemek istiyor?</div>
      </div>
      <div class="input-card">
        <label class="input-label">â˜… BugÃ¼n NasÄ±l Hissediyorsun?</label>
        <textarea id="oracle-input" rows="3" placeholder="BugÃ¼nkÃ¼ ruh halini, kaygÄ±larÄ±nÄ± veya hayallerini kÄ±saca paylaÅŸ..."></textarea>
        <button class="cta-btn" onclick="tabir('oracle')" id="oracle-btn">â˜… GÃœNÃœMÃœN ENERJÄ°SÄ°NÄ° AL â˜…</button>
      </div>
      <div class="loading" id="oracle-loading">
        <span class="crystal-ball">âœ¨</span>
        <p class="loading-text">Evrenle baÄŸlantÄ± kuruyorum...</p>
      </div>
      <div class="error-msg" id="oracle-error"></div>
      <div class="oracle-share-card" id="oracle-result">
        <div class="osc-bg"></div>
        <div class="osc-lines"></div>
        <div class="osc-inner">
          <div class="osc-top">
            <div class="osc-brand"><span class="osc-brand-icon">ğŸŒ™</span><span class="osc-brand-text">KUBER RÃœYA</span></div>
            <div class="osc-date" id="osc-date"></div>
          </div>
          <div class="osc-tag">â˜… GÃ¼nÃ¼n Kozmik MesajÄ±</div>
          <div class="osc-headline" id="osc-headline">Evrenin sana bugÃ¼n bir sÄ±rrÄ± var...</div>
          <div class="osc-divider"><span class="osc-divider-icon">âœ¦</span></div>
          <div class="osc-sections" id="osc-sections"></div>
          <div class="osc-lucky" id="osc-lucky"></div>
          <div class="osc-closing" id="osc-closing"></div>
          <div class="osc-footer">
            <div class="osc-footer-tip">âœ¦ Her yeni gÃ¼n yeni bir baÅŸlangÄ±Ã§</div>
            <div class="osc-footer-logo">KUBER RÃœYA</div>
          </div>
        </div>
      </div>
      <div class="oracle-actions" id="oracle-actions">
        <button class="oracle-action-btn" onclick="resetPanel('oracle')">â˜… YENÄ°DEN AL</button>
        <button class="oracle-action-btn" onclick="shareOracle()">â†— PAYLAÅ</button>
      </div>
    </div>

  </main>
</div>

<script>
// â”€â”€ YÄ±ldÄ±zlar â”€â”€
const starsEl = document.getElementById('stars');
for (let i = 0; i < 100; i++) {
  const s = document.createElement('div'); s.className = 'star';
  const sz = Math.random() * 2.5 + 0.5;
  s.style.cssText = `width:${sz}px;height:${sz}px;top:${Math.random()*100}%;left:${Math.random()*100}%;--d:${Math.random()*3+2}s;--delay:${Math.random()*4}s;`;
  starsEl.appendChild(s);
}

// â”€â”€ KullanÄ±cÄ± Bilgileri â”€â”€
let userInfo = { ad: '', dogumTarihi: '', medeni: '', calisma: '' };
let selectedMedeni = '';
let selectedCalisma = '';

// GÃ¼n ve yÄ±l doldur
const daySelect = document.getElementById('w-day');
const yearSelect = document.getElementById('w-year');
for (let d = 1; d <= 31; d++) { const o = document.createElement('option'); o.value = d; o.textContent = d; daySelect.appendChild(o); }
const currentYear = new Date().getFullYear();
for (let y = currentYear; y >= 1920; y--) { const o = document.createElement('option'); o.value = y; o.textContent = y; yearSelect.appendChild(o); }

function selectToggle(group, val) {
  if (group === 'medeni') {
    selectedMedeni = val;
    document.getElementById('btn-bekar').classList.toggle('selected', val === 'bekar');
    document.getElementById('btn-evli').classList.toggle('selected', val === 'evli');
  } else {
    selectedCalisma = val;
    document.getElementById('btn-calisiyor').classList.toggle('selected', val === 'calisiyor');
    document.getElementById('btn-calismÄ±yor').classList.toggle('selected', val === 'calismÄ±yor');
  }
}

function submitWelcome() {
  const ad = document.getElementById('w-name').value.trim();
  const gun = document.getElementById('w-day').value;
  const ay = document.getElementById('w-month').value;
  const yil = document.getElementById('w-year').value;
  const errEl = document.getElementById('form-error');

  if (!ad || !gun || !ay || !yil || !selectedMedeni || !selectedCalisma) {
    errEl.classList.add('show');
    return;
  }
  errEl.classList.remove('show');

  const aylar = ['','Ocak','Åubat','Mart','Nisan','MayÄ±s','Haziran','Temmuz','AÄŸustos','EylÃ¼l','Ekim','KasÄ±m','AralÄ±k'];
  userInfo = {
    ad,
    dogumTarihi: `${gun} ${aylar[parseInt(ay)]} ${yil}`,
    medeni: selectedMedeni === 'evli' ? 'evli' : 'bekar',
    calisma: selectedCalisma === 'calisiyor' ? 'Ã§alÄ±ÅŸÄ±yor' : 'Ã§alÄ±ÅŸmÄ±yor'
  };

  // AdÄ± al (sadece ilk kelime kullan hitapta)
  const firstName = ad.split(' ')[0];
  document.getElementById('user-greeting').textContent = `HoÅŸ geldin, ${firstName} âœ¦`;

  document.getElementById('welcome-screen').classList.add('hidden');
  document.getElementById('app').classList.add('show');
}

// â”€â”€ Fal state â”€â”€
let selectedFalType = 'kahve';
let uploadedPhotoBase64 = null;
let uploadedPhotoMime = 'image/jpeg';

const falTypeIcons = { kahve:'â˜•', el:'ğŸ¤²', yildiz:'â­', genel:'ğŸŒŸ' };
const falTypeNames = { kahve:'Kahve FalÄ±', el:'El FalÄ±', yildiz:'YÄ±ldÄ±z FalÄ±', genel:'Genel Fal' };
const falPhotoTypes = ['kahve', 'el'];
const falPhotoSubs = {
  kahve: 'Kahve fincanÄ±nÄ±n fotoÄŸrafÄ±nÄ± Ã§ek, KUBER telveden okusun',
  el: 'El ayasÄ±nÄ±n fotoÄŸrafÄ±nÄ± Ã§ek, KUBER Ã§izgilerden okusun'
};

// â”€â”€ KullanÄ±cÄ± baÄŸlamÄ± â”€â”€
function userContext() {
  const firstName = userInfo.ad.split(' ')[0];
  return `KullanÄ±cÄ± bilgileri: AdÄ± ${userInfo.ad}, doÄŸum tarihi ${userInfo.dogumTarihi}, medeni durumu ${userInfo.medeni}, Ã§alÄ±ÅŸma durumu ${userInfo.calisma}. Bu bilgileri yorumuna dahil et ve kullanÄ±cÄ±ya "${firstName}" diye hitap et.`;
}

function switchTab(tab, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('panel-' + tab).classList.add('active');
}

function selectFalType(btn) {
  document.querySelectorAll('.fortune-type-btn').forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');
  selectedFalType = btn.dataset.type;
  document.getElementById('fal-result-icon').textContent = falTypeIcons[selectedFalType];
  document.getElementById('fal-result-category').textContent = falTypeNames[selectedFalType];
  const wrap = document.getElementById('fal-photo-wrap');
  if (falPhotoTypes.includes(selectedFalType)) {
    wrap.style.display = 'block';
    document.getElementById('fal-photo-sub').textContent = falPhotoSubs[selectedFalType];
  } else {
    wrap.style.display = 'none';
    removePhoto();
  }
}

function handlePhotoUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  uploadedPhotoMime = file.type || 'image/jpeg';
  const reader = new FileReader();
  reader.onload = (e) => {
    uploadedPhotoBase64 = e.target.result.split(',')[1];
    document.getElementById('fal-photo-img').src = e.target.result;
    document.getElementById('fal-photo-preview').classList.add('show');
    document.getElementById('fal-upload-area').style.display = 'none';
  };
  reader.readAsDataURL(file);
}

function removePhoto() {
  uploadedPhotoBase64 = null;
  const input = document.getElementById('fal-photo-input');
  if (input) input.value = '';
  const preview = document.getElementById('fal-photo-preview');
  if (preview) preview.classList.remove('show');
  const area = document.getElementById('fal-upload-area');
  if (area) area.style.display = 'block';
}

function resetPanel(type) {
  document.getElementById(type + '-result').classList.remove('show');
  if (type === 'fal') removePhoto();
  if (type === 'oracle') document.getElementById('oracle-actions').classList.remove('show');
  const inp = document.getElementById(type + '-input');
  if (inp) inp.value = '';
  document.getElementById(type + '-error').classList.remove('show');
}

function shareOracle() {
  if (navigator.share) {
    navigator.share({ title: 'KUBER RÃœYA â€” GÃ¼nÃ¼n Kozmik MesajÄ±', text: 'KUBER bana bugÃ¼nÃ¼n mesajÄ±nÄ± verdi! âœ¨', url: window.location.href });
  } else {
    navigator.clipboard?.writeText(window.location.href).then(() => alert('Link kopyalandÄ±!'));
  }
}

// â”€â”€ HTML bÃ¶lÃ¼m ÅŸablonu â”€â”€
function buildHtmlFormat(b1, b2, b3, b4) {
  return `YanÄ±tÄ±nÄ± YALNIZCA aÅŸaÄŸÄ±daki HTML yapÄ±sÄ±nda ver. KÃ¶ÅŸeli parantez iÃ§indekiler yÃ¶nergedir, sil ve gerÃ§ek TÃ¼rkÃ§e iÃ§erik yaz. Markdown kullanma:

<div class="k-section">
<div class="k-section-title"><span class="k-emoji">${b1.emoji}</span> ${b1.baslik}</div>
<p>[${b1.icerik}]</p>
</div>
<div class="k-section">
<div class="k-section-title"><span class="k-emoji">${b2.emoji}</span> ${b2.baslik}</div>
<p>[${b2.icerik}]</p>
</div>
<div class="k-section">
<div class="k-section-title"><span class="k-emoji">${b3.emoji}</span> ${b3.baslik}</div>
<p>[${b3.icerik}]</p>
</div>
<div class="k-section">
<div class="k-section-title"><span class="k-emoji">${b4.emoji}</span> ${b4.baslik}</div>
<p>[${b4.icerik}]</p>
</div>
<div class="k-closing">[Ben KUBER olarak... ile baÅŸlayan gÃ¼Ã§lÃ¼ kapanÄ±ÅŸ. 1-2 cÃ¼mle. KullanÄ±cÄ±ya adÄ±yla hitap et.]</div>`;
}

// â”€â”€ Tabir â”€â”€
async function tabir(type) {
  const input = document.getElementById(type + '-input') ? document.getElementById(type + '-input').value.trim() : '';
  const btn = document.getElementById(type + '-btn');
  const loading = document.getElementById(type + '-loading');
  const result = document.getElementById(type + '-result');
  const error = document.getElementById(type + '-error');
  const firstName = userInfo.ad.split(' ')[0];

  result.classList.remove('show');
  error.classList.remove('show');

  let prompt = '';
  let requestBody = {};

  if (type === 'ruya') {
    if (!input) { showError(type, 'âœ¦ LÃ¼tfen Ã¶nce rÃ¼yanÄ± anlat...'); return; }
    prompt = `Sen KUBER'sin â€” kadim ve gizemli bir rÃ¼ya yorumcusu. ${userContext()}

RÃ¼ya: "${input}"

` + buildHtmlFormat(
      { emoji:'ğŸ”®', baslik:'Sembollerin Dili', icerik:`RÃ¼yadaki ana nesneler ve karakterlerin mistik anlamÄ±nÄ± ${firstName}'e aÃ§Ä±kla. 2-3 cÃ¼mle.` },
      { emoji:'ğŸŒŠ', baslik:'BilinÃ§altÄ±nÄ±n Sesi', icerik:`${firstName}'in bu rÃ¼yadaki bilinÃ§altÄ± mesajÄ±nÄ± yorumla. 2-3 cÃ¼mle.` },
      { emoji:'ğŸŒ™', baslik:'YakÄ±n Gelecek', icerik:`Bu rÃ¼yanÄ±n ${firstName} iÃ§in yakÄ±n gelecekte ne anlama geldiÄŸini anlat. 2-3 cÃ¼mle.` },
      { emoji:'âœ¨', baslik:'Ruhsal Mesaj', icerik:`${firstName}'e Ã¶zel ruhsal anlam ve evrensel mesaj. 2-3 cÃ¼mle.` }
    );
    requestBody = { prompt };

  } else if (type === 'fal') {
    const topic = input || 'genel hayat, aÅŸk ve kariyer';
    const hasPhoto = !!uploadedPhotoBase64;

    // FotoÄŸraf validasyonu iÃ§in Ã¶zel talimat
    const kahveKontrol = `
GÃ–REV 1 â€” FOTOÄRAF KONTROLÃœ:
Bu fotoÄŸrafa bak. Ä°Ã§inde kahve, kahve fincanÄ±, kahve telvesi, TÃ¼rk kahvesi, espresso veya herhangi bir kahve iÃ§eceÄŸi var mÄ±?
- EÄŸer VARSA: Fal yorumunu yap, fincan ve telvadeki ÅŸekilleri, desenleri, sembolleri analiz ederek yorumuna dahil et.
- EÄŸer YOKSA (yani fotoÄŸraf tamamen farklÄ± bir ÅŸeyse â€” insan, hayvan, manzara, yemek, ekran gÃ¶rÃ¼ntÃ¼sÃ¼ vs.): Sadece ÅŸunu yaz: "â˜• Bu fotoÄŸraf kahve falÄ± iÃ§in uygun deÄŸil. LÃ¼tfen kahve fincanÄ±nÄ±zÄ±n veya telvenizin fotoÄŸrafÄ±nÄ± yÃ¼kleyin." â€” BaÅŸka hiÃ§bir ÅŸey yazma, fal yorumu yapma.`;

    const elKontrol = `
GÃ–REV 1 â€” FOTOÄRAF KONTROLÃœ:
Bu fotoÄŸrafa bak. Ä°Ã§inde insan eli veya avuÃ§ iÃ§i (palm) gÃ¶rÃ¼nÃ¼yor mu? El Ã§izgileri, parmaklar veya el ayasÄ± fotoÄŸrafÄ± mÄ± bu?
- EÄŸer EVET, bir insan eli gÃ¶rÃ¼nÃ¼yorsa: Fal yorumunu yap, eldeki Ã§izgileri, ÅŸekilleri ve sembolleri analiz ederek yorumuna dahil et.
- EÄŸer HAYIR, elde insan eli yoksa (masa, nesne, manzara, ekran gÃ¶rÃ¼ntÃ¼sÃ¼, hayvan vs.): Sadece ÅŸunu yaz: "ğŸ¤² Bu fotoÄŸraf el falÄ± iÃ§in uygun deÄŸil. LÃ¼tfen aÃ§Ä±k el ayasÄ±nÄ±n fotoÄŸrafÄ±nÄ± yÃ¼kleyin." â€” BaÅŸka hiÃ§bir ÅŸey yazma, fal yorumu yapma.`;

    const photoInstruction = hasPhoto
      ? (selectedFalType === 'kahve' ? kahveKontrol : elKontrol)
      : '';

    prompt = `Sen KUBER'sin â€” ${falTypeNames[selectedFalType]} ustasÄ±. ${userContext()}
${photoInstruction}

${hasPhoto ? 'EÄŸer fotoÄŸraf uygunsa, aÅŸaÄŸÄ±daki formatta fal yorumu yap. Uygun deÄŸilse yukarÄ±daki uyarÄ±yÄ± ver ve dur.' : ''}
Konu: "${topic}" | Fal: ${falTypeNames[selectedFalType]}

` + buildHtmlFormat(
      { emoji:'ğŸ•°ï¸', baslik:'GeÃ§miÅŸten Gelen', icerik:`${firstName}'in geÃ§miÅŸinden gelen etkiler ve bu falda ne gÃ¶rÃ¼ndÃ¼ÄŸÃ¼. 2-3 cÃ¼mle.` },
      { emoji: falTypeIcons[selectedFalType], baslik:'Åimdiki Enerji', icerik:`${firstName} iÃ§in ÅŸu anki enerji ve ${falTypeNames[selectedFalType]}'na Ã¶zgÃ¼ semboller${hasPhoto ? ' â€” gÃ¶rselden okuduklarÄ±nÄ± dahil et' : ''}. 2-3 cÃ¼mle.` },
      { emoji:'ğŸ’«', baslik:'AÅŸk & Ä°liÅŸkiler', icerik:`${firstName}'in aÅŸk ve iliÅŸki hayatÄ±na dair fal mesajÄ±. 2-3 cÃ¼mle.` },
      { emoji:'ğŸŒŸ', baslik:'Kariyer & Bereket', icerik:`${firstName} iÃ§in kariyer ve maddi konulardaki mesaj. 2-3 cÃ¼mle.` }
    );
    requestBody = { prompt };
    if (hasPhoto) { requestBody.image = uploadedPhotoBase64; requestBody.imageType = uploadedPhotoMime; }

  } else {
    const mood = input || 'merak dolu ve hayata aÃ§Ä±k';
    prompt = `Sen KUBER'sin â€” kozmik enerjileri okuyan gizemli bir rehber. ${userContext()}

KullanÄ±cÄ±nÄ±n bugÃ¼nkÃ¼ hali: "${mood}"

SADECE aÅŸaÄŸÄ±daki JSON formatÄ±nda yanÄ±t ver. BaÅŸka hiÃ§bir ÅŸey yazma:
{
  "baslik": "[${firstName} iÃ§in bugÃ¼nÃ¼n enerjisini Ã¶zetleyen ÅŸiirsel baÅŸlÄ±k â€” 5-8 kelime]",
  "enerji": "[GÃ¼nÃ¼n kozmik enerjisi ve hangi gezegen/burÃ§ etkili â€” 2 cÃ¼mle, ${firstName}'e hitap et]",
  "eylem": "[${firstName}'in bugÃ¼n yapmasÄ± gereken eylem ve kaÃ§Ä±nmasÄ± gereken ÅŸey â€” 2 cÃ¼mle]",
  "mesaj": "[KUBER olarak ${firstName}'e gÃ¼Ã§lÃ¼ motivasyon mesajÄ± â€” 2 cÃ¼mle]",
  "sans_renk": "[ÅanslÄ± renk]",
  "sans_sayi": "[ÅanslÄ± sayÄ±]",
  "sans_sembol": "[ÅanslÄ± sembol]",
  "kapanis": "[Ben KUBER olarak ${firstName}'e... diye baÅŸlayan kapanÄ±ÅŸ â€” 1-2 cÃ¼mle]"
}
TÃ¼m iÃ§erik TÃ¼rkÃ§e.`;
    requestBody = { prompt };
  }

  btn.disabled = true;
  loading.classList.add('show');

  try {
    const res = await fetch('/api/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(requestBody)
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || 'Bir hata oluÅŸtu');

    const text = data.result || '';
    loading.classList.remove('show');

    if (type === 'oracle') {
      renderOracleCard(text);
    } else {
      // FotoÄŸraf uyarÄ±sÄ± geldi mi kontrol et (sadece dÃ¼z metin dÃ¶ndÃ¼yse)
      if (type === 'fal' && uploadedPhotoBase64 && !text.includes('k-section')) {
        showError(type, text);
        return;
      }
      document.getElementById(type + '-result-text').innerHTML = text;
      result.classList.add('show');
    }
    result.scrollIntoView({ behavior: 'smooth', block: 'start' });
  } catch (err) {
    loading.classList.remove('show');
    showError(type, 'âœ¦ Mistik baÄŸlantÄ± kesildi. LÃ¼tfen tekrar dene... (' + err.message + ')');
  } finally {
    btn.disabled = false;
  }
}

function renderOracleCard(text) {
  try {
    const clean = text.replace(/```json|```/g, '').trim();
    const d = JSON.parse(clean);
    const now = new Date();
    document.getElementById('osc-date').textContent =
      now.toLocaleDateString('tr-TR', { day:'numeric', month:'long', year:'numeric' });
    document.getElementById('osc-headline').textContent = d.baslik || '';
    document.getElementById('osc-sections').innerHTML = `
      <div class="osc-section"><div class="osc-section-icon">ğŸŒ…</div><div><div class="osc-section-label">GÃ¼nÃ¼n Enerjisi</div><div class="osc-section-text">${d.enerji||''}</div></div></div>
      <div class="osc-section"><div class="osc-section-icon">âš¡</div><div><div class="osc-section-label">BugÃ¼n & KaÃ§Ä±n</div><div class="osc-section-text">${d.eylem||''}</div></div></div>
      <div class="osc-section"><div class="osc-section-icon">ğŸ”¥</div><div><div class="osc-section-label">KUBER'in MesajÄ±</div><div class="osc-section-text">${d.mesaj||''}</div></div></div>`;
    document.getElementById('osc-lucky').innerHTML = `
      <div class="osc-lucky-item"><span class="osc-lucky-label">ğŸ¨ Renk</span><span class="osc-lucky-val">${d.sans_renk||''}</span></div>
      <div class="osc-lucky-item"><span class="osc-lucky-label">ğŸ”¢ SayÄ±</span><span class="osc-lucky-val">${d.sans_sayi||''}</span></div>
      <div class="osc-lucky-item"><span class="osc-lucky-label">âœ¨ Sembol</span><span class="osc-lucky-val">${d.sans_sembol||''}</span></div>`;
    document.getElementById('osc-closing').textContent = d.kapanis || '';
  } catch(e) {
    document.getElementById('osc-headline').textContent = 'Evren bugÃ¼n sana sesleniyor...';
    document.getElementById('osc-sections').innerHTML = `<div class="osc-section"><div class="osc-section-text">${text}</div></div>`;
    document.getElementById('osc-lucky').innerHTML = '';
    document.getElementById('osc-closing').textContent = '';
  }
  document.getElementById('oracle-result').classList.add('show');
  document.getElementById('oracle-actions').classList.add('show');
}

function showError(type, msg) {
  const el = document.getElementById(type + '-error');
  el.textContent = msg;
  el.classList.add('show');
}
</script>
</body>
</html>
